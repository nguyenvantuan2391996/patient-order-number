<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Patient CRUD System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body {
      background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .loading {
      display: none;
    }
    .toast {
      position: fixed;
      top: 20px; /* Move to the top */
      right: 20px; /* Keep on the right */
      background-color: #38a169; /* Green color */
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      opacity: 0;
      transition: opacity 0.5s ease;
    }
    .toast.show {
      opacity: 1;
    }
  </style>
</head>
<body class="min-h-screen p-6 flex items-center justify-center">

<!-- Main container -->
<div class="container mx-auto p-6 max-w-lg bg-white rounded-lg shadow-lg space-y-6">

  <!-- View Patient List Screen -->
  <div id="viewPatientListScreen" class="screen">
    <h2 class="text-3xl font-bold text-gray-700 mb-4">Danh Sách Khám Bệnh</h2>
    <div class="flex items-center mb-4">
      <label class="block text-sm font-medium text-gray-700 mr-2">Chọn Ngày:</label>
      <input type="date" id="appointmentDate" class="border rounded-md p-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
    </div>
    <ul id="patientList" class="space-y-3">
      <!-- Patient items will be dynamically added here -->
    </ul>
  </div>

  <!-- Create Patient Screen -->
  <div id="createPatientScreen" class="screen hidden">
    <h2 class="text-3xl font-bold text-gray-700 mb-4">Thêm Thông Tin</h2>
    <form id="addPatientForm" class="space-y-6">
      <div>
        <label class="block text-sm font-medium text-gray-700">Tên</label>
        <input type="text" id="patientName" class="w-full mt-1 p-3 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Tuổi</label>
        <input type="number" id="patientAge" class="w-full mt-1 p-3 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Giới Tính</label>
        <select class="w-full mt-1 p-3 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
          <option id="male" selected>Nam</option>
          <option id="female">Nữ</option>
          <option id="other">Khác</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Phòng</label>
        <input type="text" id="patientCondition1" class="w-full mt-1 p-3 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Bác Sĩ</label>
        <input type="text" id="patientCondition2" class="w-full mt-1 p-3 border rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
      <button type="submit" id="submitBtn" class="w-full bg-blue-500 text-white p-3 rounded-lg shadow-md hover:bg-blue-600 transition-all duration-200">
        <span id="submitText">Lưu</span>
        <span id="loadingSpinner" class="hidden loading inline-block w-5 h-5 border-4 border-white border-t-transparent rounded-full animate-spin ml-2"></span>
      </button>
    </form>
  </div>

</div>

<!-- Floating button to Create Patient -->
<button id="createScreenBtn" class="fixed bottom-6 right-6 bg-blue-500 text-white p-5 rounded-full shadow-lg hover:bg-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-300 transition-all duration-200">
  <i class="fas fa-plus text-2xl"></i>
</button>

<!-- Toast Notification -->
<div id="toast" class="toast">
  Patient added successfully!
</div>

<!-- Template for patient item -->
<template id="patientTemplate">
  <li class="bg-gray-50 p-4 rounded-lg flex justify-between items-center shadow-md transition-all duration-200 hover:shadow-lg">
    <div class="flex-1">
      <h3 class="font-bold text-lg text-gray-800" id="patientNameTemplate"></h3>
      <p class="text-sm text-gray-600" id="patientAgeTemplate"></p>
      <p class="text-sm text-gray-600" id="patientConditionTemplate"></p>
    </div>
    <div class="space-x-3 flex">
      <button class="text-yellow-500 hover:text-yellow-600 transition-colors duration-200 edit-btn">
        <i class="fas fa-edit text-xl"></i>
      </button>
      <button class="text-red-500 hover:text-red-600 transition-colors duration-200 delete-btn">
        <i class="fas fa-trash-alt text-xl"></i>
      </button>
    </div>
  </li>
</template>

<script>
  // Toggle between screens
  const createScreen = document.getElementById('createPatientScreen');
  const listScreen = document.getElementById('viewPatientListScreen');
  const createScreenBtn = document.getElementById('createScreenBtn');

  createScreenBtn.addEventListener('click', () => {
    createScreen.classList.remove('hidden');
    listScreen.classList.add('hidden');
    createScreenBtn.classList.add('hidden');
  });

  // Patient data
  const patients = [];

  // Add new patient
  const addPatientForm = document.getElementById('addPatientForm');
  const submitBtn = document.getElementById('submitBtn');
  const submitText = document.getElementById('submitText');
  const loadingSpinner = document.getElementById('loadingSpinner');
  const toast = document.getElementById('toast');

  addPatientForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const name = document.getElementById('patientName').value;
    const age = document.getElementById('patientAge').value;
    const condition = document.getElementById('patientCondition1').value;

    if (name && age && condition) {
      // Show loading spinner
      submitText.classList.add('hidden');
      loadingSpinner.classList.remove('hidden');

      await createPatient()

      const newPatient = {name, age, condition};
      patients.push(newPatient);

      // patient list
      displayPatients();
      addPatientForm.reset();
      listScreen.classList.remove('hidden');
      createScreenBtn.classList.remove('hidden');
      createScreen.classList.add('hidden');

      // Hide loading spinner
      submitText.classList.remove('hidden');
      loadingSpinner.classList.add('hidden');

      // Show toast notification
      showToast();
    }
  });

  // Display patients
  const displayPatients = () => {
    const patientList = document.getElementById('patientList');
    patientList.innerHTML = '';

    patients.forEach((patient, index) => {
      const template = document.getElementById('patientTemplate').content.cloneNode(true);
      template.querySelector('#patientNameTemplate').textContent = patient.name;
      template.querySelector('#patientAgeTemplate').textContent = `Age: ${patient.age}`;
      template.querySelector('#patientConditionTemplate').textContent = `Condition: ${patient.condition}`;

      const deleteBtn = template.querySelector('.delete-btn');
      deleteBtn.addEventListener('click', () => {
        patients.splice(index, 1);
        displayPatients();
      });

      const editBtn = template.querySelector('.edit-btn');
      editBtn.addEventListener('click', () => {
        document.getElementById('patientName').value = patient.name;
        document.getElementById('patientAge').value = patient.age;
        document.getElementById('patientCondition').value = patient.condition;
        patients.splice(index, 1);
        createScreen.classList.remove('hidden');
        listScreen.classList.add('hidden');
      });

      patientList.appendChild(template);
    });
  };

  async function createPatient() {
    const myHeaders = new Headers();
    myHeaders.append("api-key", "c3kvxLTTVaAF5aQU2BHRBnaI7kFvVzt3aJSZfUav6RzmKM6cBN");

    const formdata = new FormData();
    formdata.append("channel", "1");
    formdata.append("name", "2");
    formdata.append("sex", "Nam");
    formdata.append("room_number", "01");
    formdata.append("doctor_name", "hihi");
    formdata.append("status", "Đợi Khám");
    formdata.append("order_number", "12");
    formdata.append("age", "80");

    const requestOptions = {
      method: "POST",
      headers: myHeaders,
      body: formdata,
      redirect: "follow"
    };

    await fetch(window.location.protocol + "//" + window.location.host + "/v1/api/patient", requestOptions)
            .then((response) => response.json())
            .then((result) => console.log(result))
            .catch((error) => console.error(error));
  }

  // Show toast notification
  const showToast = () => {
    toast.classList.add('show');
    setTimeout(() => {
      toast.classList.remove('show');
    }, 3000); // Show for 3 seconds
  };
</script>

</body>
</html>
